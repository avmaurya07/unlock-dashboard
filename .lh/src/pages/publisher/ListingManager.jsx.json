{
    "sourceFile": "src/pages/publisher/ListingManager.jsx",
    "activeCommit": 0,
    "commits": [
        {
            "activePatchIndex": 0,
            "patches": [
                {
                    "date": 1767958208268,
                    "content": "Index: \n===================================================================\n--- \n+++ \n"
                }
            ],
            "date": 1767958208268,
            "name": "Commit-0",
            "content": "import { useEffect, useMemo, useState } from \"react\";\nimport { ToastContainer, toast } from \"react-toastify\";\nimport { loadMock, saveMock, uid } from \"../../utils/mockStore\";\n\nconst DEFAULT_PAGE_SIZE = 10;\n\nexport default function ListingManager({\n  typeKey,              // \"events\" | \"jobs\" | ...\n  title,                // Page title\n  subtitle,             // small text\n  addButtonText,        // button label\n  fields,               // form fields config\n  sampleData = [],      // seed data if empty\n  searchKeys = [\"title\"],\n  pageSize = DEFAULT_PAGE_SIZE,\n}) {\n  const [items, setItems] = useState([]);\n  const [status, setStatus] = useState(\"all\");\n  const [q, setQ] = useState(\"\");\n  const [page, setPage] = useState(1);\n\n  const [showModal, setShowModal] = useState(false);\n  const [creating, setCreating] = useState(false);\n\n  const initialForm = useMemo(() => {\n    const obj = {};\n    fields.forEach((f) => (obj[f.name] = f.defaultValue ?? \"\"));\n    return obj;\n  }, [fields]);\n\n  const [form, setForm] = useState(initialForm);\n\n  // load from localStorage\n  useEffect(() => {\n    const loaded = loadMock(typeKey, []);\n    if (loaded.length === 0 && sampleData.length) {\n      saveMock(typeKey, sampleData);\n      setItems(sampleData);\n    } else {\n      setItems(loaded);\n    }\n    // eslint-disable-next-line react-hooks/exhaustive-deps\n  }, [typeKey]);\n\n  // persist\n  useEffect(() => {\n    saveMock(typeKey, items);\n  }, [typeKey, items]);\n\n  const filtered = useMemo(() => {\n    const query = q.trim().toLowerCase();\n\n    return items\n      .filter((it) => (status === \"all\" ? true : (it.status || \"pending\") === status))\n      .filter((it) => {\n        if (!query) return true;\n        return searchKeys.some((k) => String(it[k] || \"\").toLowerCase().includes(query));\n      })\n      .sort((a, b) => new Date(b.createdAt) - new Date(a.createdAt));\n  }, [items, status, q, searchKeys]);\n\n  const total = filtered.length;\n  const pages = Math.max(1, Math.ceil(total / pageSize));\n  const paged = filtered.slice((page - 1) * pageSize, page * pageSize);\n\n  useEffect(() => {\n    setPage(1);\n  }, [status, q]);\n\n  function openModal() {\n    setForm(initialForm);\n    setShowModal(true);\n  }\n\n  function closeModal() {\n    setShowModal(false);\n  }\n\n  function badge(s = \"pending\") {\n    const cls =\n      s === \"approved\" ? \"text-bg-success\" :\n      s === \"rejected\" ? \"text-bg-danger\" : \"text-bg-warning\";\n    return <span className={`badge ${cls}`}>{s}</span>;\n  }\n\n  function validate() {\n    for (const f of fields) {\n      if (f.required && !String(form[f.name] || \"\").trim()) {\n        toast.warn(`${f.label} is required`);\n        return false;\n      }\n    }\n    return true;\n  }\n\n  async function createItem() {\n    if (!validate()) return;\n    setCreating(true);\n\n    // fake delay for UX\n    setTimeout(() => {\n      const newItem = {\n        _id: uid(),\n        status: \"pending\",\n        createdAt: new Date().toISOString(),\n        ...form,\n      };\n\n      setItems((prev) => [newItem, ...prev]);\n      toast.success(\"Created! (Pending approval)\");\n      setCreating(false);\n      closeModal();\n    }, 350);\n  }\n\n  function resetFilters() {\n    setStatus(\"all\");\n    setQ(\"\");\n    setPage(1);\n  }\n\n  function deleteItem(id) {\n    if (!confirm(\"Delete this item?\")) return;\n    setItems((prev) => prev.filter((x) => x._id !== id));\n    toast.success(\"Deleted\");\n  }\n\n  return (\n    <div className=\"w-100\">\n      {/* Header */}\n      <div className=\"d-flex justify-content-between align-items-center mb-3\">\n        <div>\n          <h2 className=\"mb-0\">{title}</h2>\n          <div className=\"text-muted\">{subtitle}</div>\n        </div>\n\n        <button className=\"btn btn-primary\" onClick={openModal}>\n          <i className=\"bi bi-plus-lg me-2\" />\n          {addButtonText}\n        </button>\n      </div>\n\n      {/* Filters */}\n      <div className=\"card shadow-sm mb-3\">\n        <div className=\"card-body\">\n          <div className=\"row g-2 align-items-end\">\n            <div className=\"col-12 col-md-3\">\n              <label className=\"form-label\">Status</label>\n              <select className=\"form-select\" value={status} onChange={(e) => setStatus(e.target.value)}>\n                <option value=\"all\">All</option>\n                <option value=\"pending\">Pending</option>\n                <option value=\"approved\">Approved</option>\n                <option value=\"rejected\">Rejected</option>\n              </select>\n            </div>\n\n            <div className=\"col-12 col-md-6\">\n              <label className=\"form-label\">Search</label>\n              <input\n                className=\"form-control\"\n                placeholder=\"Search...\"\n                value={q}\n                onChange={(e) => setQ(e.target.value)}\n              />\n            </div>\n\n            <div className=\"col-12 col-md-3 d-flex gap-2\">\n              <button className=\"btn btn-outline-secondary w-100\" onClick={resetFilters}>\n                Reset\n              </button>\n              <button\n                className=\"btn btn-outline-dark w-100\"\n                onClick={() => {\n                  saveMock(typeKey, sampleData);\n                  setItems(sampleData);\n                  toast.info(\"Reset to sample data\");\n                }}\n              >\n                Sample\n              </button>\n            </div>\n          </div>\n        </div>\n      </div>\n\n      {/* Table */}\n      <div className=\"card shadow-sm\">\n        <div className=\"card-body\">\n          <div className=\"d-flex justify-content-between align-items-center mb-2\">\n            <div className=\"text-muted\">\n              Showing <b>{total ? (page - 1) * pageSize + 1 : 0}</b> to{\" \"}\n              <b>{Math.min(page * pageSize, total)}</b> of <b>{total}</b>\n            </div>\n            <div className=\"small text-muted\">\n              New items are always <b>Pending</b> until admin approval.\n            </div>\n          </div>\n\n          <div className=\"table-responsive\">\n            <table className=\"table align-middle\">\n              <thead className=\"table-light\">\n                <tr>\n                  <th style={{ width: 70 }}>#</th>\n                  <th>Title</th>\n                  <th>Status</th>\n                  <th>Details</th>\n                  <th>Created</th>\n                  <th className=\"text-end\" style={{ width: 140 }}>Action</th>\n                </tr>\n              </thead>\n\n              <tbody>\n                {paged.length === 0 ? (\n                  <tr>\n                    <td colSpan=\"6\" className=\"text-center text-muted py-4\">\n                      No items found.\n                    </td>\n                  </tr>\n                ) : (\n                  paged.map((it, idx) => (\n                    <tr key={it._id}>\n                      <td>{(page - 1) * pageSize + idx + 1}</td>\n                      <td>\n                        <div className=\"fw-semibold\">{it.title}</div>\n                        {it.subtitle && <div className=\"text-muted small\">{it.subtitle}</div>}\n                      </td>\n                      <td>{badge(it.status)}</td>\n                      <td className=\"small text-muted\">\n                        {renderDetails(fields, it)}\n                      </td>\n                      <td className=\"small text-muted\">\n                        {it.createdAt ? new Date(it.createdAt).toLocaleString() : \"-\"}\n                      </td>\n                      <td className=\"text-end\">\n                        <button className=\"btn btn-sm btn-outline-danger\" onClick={() => deleteItem(it._id)}>\n                          Delete\n                        </button>\n                      </td>\n                    </tr>\n                  ))\n                )}\n              </tbody>\n            </table>\n          </div>\n\n          {/* Pagination */}\n          {pages > 1 && (\n            <div className=\"d-flex justify-content-end mt-2\">\n              <div className=\"btn-group\">\n                <button className=\"btn btn-outline-secondary\" disabled={page === 1} onClick={() => setPage((p) => p - 1)}>\n                  Prev\n                </button>\n                <button className=\"btn btn-outline-secondary\" disabled={page === pages} onClick={() => setPage((p) => p + 1)}>\n                  Next\n                </button>\n              </div>\n            </div>\n          )}\n        </div>\n      </div>\n\n      {/* Modal */}\n      {showModal && (\n        <div className=\"modal show d-block\" tabIndex=\"-1\">\n          <div className=\"modal-dialog modal-lg modal-dialog-centered\">\n            <div className=\"modal-content\">\n              <div className=\"modal-header\">\n                <h5 className=\"modal-title\">{addButtonText}</h5>\n                <button type=\"button\" className=\"btn-close\" onClick={closeModal} />\n              </div>\n\n              <div className=\"modal-body\">\n                <div className=\"row g-3\">\n                  {fields.map((f) => (\n                    <div key={f.name} className={f.col || \"col-12\"}>\n                      <label className=\"form-label\">\n                        {f.label} {f.required ? \"*\" : \"\"}\n                      </label>\n\n                      {f.type === \"textarea\" ? (\n                        <textarea\n                          className=\"form-control\"\n                          rows={4}\n                          value={form[f.name]}\n                          onChange={(e) => setForm({ ...form, [f.name]: e.target.value })}\n                          placeholder={f.placeholder || \"\"}\n                        />\n                      ) : f.type === \"select\" ? (\n                        <select\n                          className=\"form-select\"\n                          value={form[f.name]}\n                          onChange={(e) => setForm({ ...form, [f.name]: e.target.value })}\n                        >\n                          <option value=\"\">Select</option>\n                          {(f.options || []).map((op) => (\n                            <option key={op.value} value={op.value}>\n                              {op.label}\n                            </option>\n                          ))}\n                        </select>\n                      ) : (\n                        <input\n                          type={f.type || \"text\"}\n                          className=\"form-control\"\n                          value={form[f.name]}\n                          onChange={(e) => setForm({ ...form, [f.name]: e.target.value })}\n                          placeholder={f.placeholder || \"\"}\n                        />\n                      )}\n                    </div>\n                  ))}\n                </div>\n\n                <div className=\"alert alert-warning mt-3 mb-0\">\n                  Note: This will be created as <b>Pending</b> until admin approves.\n                </div>\n              </div>\n\n              <div className=\"modal-footer\">\n                <button className=\"btn btn-outline-secondary\" onClick={closeModal} disabled={creating}>\n                  Cancel\n                </button>\n                <button className=\"btn btn-primary\" onClick={createItem} disabled={creating}>\n                  {creating ? \"Creating...\" : \"Create\"}\n                </button>\n              </div>\n            </div>\n          </div>\n\n          <div className=\"modal-backdrop show\" onClick={closeModal} />\n        </div>\n      )}\n\n      <ToastContainer position=\"top-center\" />\n    </div>\n  );\n}\n\nfunction renderDetails(fields, item) {\n  // show 2-3 key fields only (excluding title/description)\n  const skip = new Set([\"title\", \"description\"]);\n  const candidates = fields\n    .map((f) => f.name)\n    .filter((k) => !skip.has(k) && item[k])\n    .slice(0, 3);\n\n  if (candidates.length === 0) return \"-\";\n\n  return (\n    <div>\n      {candidates.map((k) => (\n        <div key={k}>\n          <b>{pretty(k)}:</b> {String(item[k])}\n        </div>\n      ))}\n    </div>\n  );\n}\n\nfunction pretty(s) {\n  return s.replace(/([A-Z])/g, \" $1\").replace(/^./, (c) => c.toUpperCase());\n}\n"
        }
    ]
}