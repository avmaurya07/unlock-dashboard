{
    "sourceFile": "src/pages/admin/PublisherTypes.jsx",
    "activeCommit": 0,
    "commits": [
        {
            "activePatchIndex": 0,
            "patches": [
                {
                    "date": 1766949817017,
                    "content": "Index: \n===================================================================\n--- \n+++ \n"
                }
            ],
            "date": 1766949817017,
            "name": "Commit-0",
            "content": "import { useEffect, useMemo, useState } from \"react\";\nimport { ToastContainer, toast } from \"react-toastify\";\nimport \"react-toastify/dist/ReactToastify.css\";\n\nconst API_BASE = import.meta.env.VITE_API_BASE_URL || \"http://localhost:5000\";\n\nfunction getToken() {\n  return localStorage.getItem(\"token\"); // adjust if you store elsewhere\n}\n\nasync function api(path, options = {}) {\n  const token = getToken();\n  const res = await fetch(`${API_BASE}${path}`, {\n    ...options,\n    headers: {\n      \"Content-Type\": \"application/json\",\n      ...(options.headers || {}),\n      ...(token ? { Authorization: `Bearer ${token}` } : {}),\n    },\n  });\n\n  const data = await res.json().catch(() => ({}));\n  if (!res.ok) {\n    const msg = data?.message || \"Request failed\";\n    throw new Error(msg);\n  }\n  return data;\n}\n\nexport default function PublisherTypes() {\n  const [loading, setLoading] = useState(false);\n  const [types, setTypes] = useState([]);\n\n  // filters\n  const [status, setStatus] = useState(\"all\"); // all | active | inactive\n  const [q, setQ] = useState(\"\");\n\n  // create/edit modal\n  const [showModal, setShowModal] = useState(false);\n  const [mode, setMode] = useState(\"create\"); // create|edit\n  const [currentId, setCurrentId] = useState(null);\n\n  const [name, setName] = useState(\"\");\n  const [description, setDescription] = useState(\"\");\n\n  const filteredCount = useMemo(() => types.length, [types]);\n\n  const openCreate = () => {\n    setMode(\"create\");\n    setCurrentId(null);\n    setName(\"\");\n    setDescription(\"\");\n    setShowModal(true);\n  };\n\n  const openEdit = (t) => {\n    setMode(\"edit\");\n    setCurrentId(t._id);\n    setName(t.name || \"\");\n    setDescription(t.description || \"\");\n    setShowModal(true);\n  };\n\n  const closeModal = () => {\n    setShowModal(false);\n  };\n\n  const fetchTypes = async () => {\n    try {\n      setLoading(true);\n      const params = new URLSearchParams();\n      if (status) params.set(\"status\", status);\n      if (q.trim()) params.set(\"q\", q.trim());\n\n      const data = await api(`/api/admin/publisher-types?${params.toString()}`, {\n        method: \"GET\",\n      });\n\n      setTypes(data.types || []);\n    } catch (e) {\n      toast.error(e.message || \"Failed to load publisher types\");\n    } finally {\n      setLoading(false);\n    }\n  };\n\n  useEffect(() => {\n    fetchTypes();\n    // eslint-disable-next-line react-hooks/exhaustive-deps\n  }, [status]);\n\n  const onSearch = (e) => {\n    e.preventDefault();\n    fetchTypes();\n  };\n\n  const saveType = async () => {\n    const n = name.trim();\n    const d = description.trim();\n\n    if (!n) return toast.error(\"Type name is required\");\n\n    try {\n      setLoading(true);\n\n      if (mode === \"create\") {\n        await api(\"/api/admin/publisher-types/create\", {\n          method: \"POST\",\n          body: JSON.stringify({ name: n, description: d }),\n        });\n        toast.success(\"Publisher type created\");\n      } else {\n        // You don't currently have update API — so we’ll use a simple approach:\n        // easiest: create update endpoint later. For now, block editing if not available.\n        // If you already have update API, tell me the route and I’ll wire it.\n        toast.error(\"Edit API not added yet. Add update endpoint first.\");\n        return;\n      }\n\n      setShowModal(false);\n      await fetchTypes();\n    } catch (e) {\n      toast.error(e.message || \"Failed to save type\");\n    } finally {\n      setLoading(false);\n    }\n  };\n\n  const toggleActive = async (t) => {\n    try {\n      setLoading(true);\n\n      if (t.isActive) {\n        // deactivate existing route\n        await api(`/api/admin/publisher-types/deactivate/${t._id}`, { method: \"PATCH\" });\n        toast.success(\"Type deactivated\");\n      } else {\n        // you don't have activate endpoint yet; quick fix: add /activate/:id later\n        toast.error(\"Activate API not added yet. Add activate endpoint first.\");\n        return;\n      }\n\n      await fetchTypes();\n    } catch (e) {\n      toast.error(e.message || \"Failed to update status\");\n    } finally {\n      setLoading(false);\n    }\n  };\n\n  return (\n    <div className=\"container-fluid\">\n      <div className=\"d-flex align-items-center justify-content-between mb-3\">\n        <div>\n          <h3 className=\"mb-0\">Publisher Types</h3>\n          <small className=\"text-muted\">Manage registration dropdown types</small>\n        </div>\n\n        <button className=\"btn btn-primary\" onClick={openCreate}>\n          + Add Type\n        </button>\n      </div>\n\n      <div className=\"card shadow-sm mb-3\">\n        <div className=\"card-body\">\n          <form className=\"row g-2 align-items-center\" onSubmit={onSearch}>\n            <div className=\"col-md-3\">\n              <label className=\"form-label mb-1\">Status</label>\n              <select className=\"form-select\" value={status} onChange={(e) => setStatus(e.target.value)}>\n                <option value=\"all\">All</option>\n                <option value=\"active\">Active</option>\n                <option value=\"inactive\">Inactive</option>\n              </select>\n            </div>\n\n            <div className=\"col-md-6\">\n              <label className=\"form-label mb-1\">Search</label>\n              <input\n                className=\"form-control\"\n                placeholder=\"Search by type name...\"\n                value={q}\n                onChange={(e) => setQ(e.target.value)}\n              />\n            </div>\n\n            <div className=\"col-md-3 d-flex gap-2 align-items-end\">\n              <button className=\"btn btn-outline-secondary w-100\" type=\"submit\">\n                Search\n              </button>\n              <button\n                className=\"btn btn-outline-dark w-100\"\n                type=\"button\"\n                onClick={() => {\n                  setQ(\"\");\n                  setStatus(\"all\");\n                  // fetchTypes will run due to status change; if not, call manually:\n                  setTimeout(fetchTypes, 0);\n                }}\n              >\n                Reset\n              </button>\n            </div>\n          </form>\n        </div>\n      </div>\n\n      <div className=\"card shadow-sm\">\n        <div className=\"card-body\">\n          <div className=\"d-flex justify-content-between mb-2\">\n            <div className=\"text-muted\">\n              {loading ? \"Loading...\" : `${filteredCount} type(s)`}\n            </div>\n          </div>\n\n          <div className=\"table-responsive\">\n            <table className=\"table align-middle\">\n              <thead>\n                <tr>\n                  <th style={{ width: 70 }}>#</th>\n                  <th>Name</th>\n                  <th>Description</th>\n                  <th style={{ width: 130 }}>Status</th>\n                  <th style={{ width: 220 }} className=\"text-end\">Actions</th>\n                </tr>\n              </thead>\n\n              <tbody>\n                {!loading && types.length === 0 ? (\n                  <tr>\n                    <td colSpan=\"5\" className=\"text-center text-muted py-4\">\n                      No publisher types found.\n                    </td>\n                  </tr>\n                ) : (\n                  types.map((t, idx) => (\n                    <tr key={t._id}>\n                      <td>{idx + 1}</td>\n                      <td className=\"fw-semibold\">{t.name}</td>\n                      <td className=\"text-muted\">{t.description || \"-\"}</td>\n                      <td>\n                        <span className={`badge ${t.isActive ? \"bg-success\" : \"bg-secondary\"}`}>\n                          {t.isActive ? \"Active\" : \"Inactive\"}\n                        </span>\n                      </td>\n                      <td className=\"text-end\">\n                        <div className=\"btn-group\">\n                          <button className=\"btn btn-sm btn-outline-primary\" onClick={() => openEdit(t)}>\n                            Edit\n                          </button>\n                          <button\n                            className={`btn btn-sm ${t.isActive ? \"btn-outline-danger\" : \"btn-outline-success\"}`}\n                            onClick={() => toggleActive(t)}\n                          >\n                            {t.isActive ? \"Deactivate\" : \"Activate\"}\n                          </button>\n                        </div>\n                      </td>\n                    </tr>\n                  ))\n                )}\n              </tbody>\n            </table>\n          </div>\n\n          <small className=\"text-muted\">\n            Note: Deactivating a type won’t delete existing publishers. It only hides it from new registration.\n          </small>\n        </div>\n      </div>\n\n      {/* Modal (Bootstrap) */}\n      {showModal && (\n        <div className=\"modal d-block\" tabIndex=\"-1\" role=\"dialog\" style={{ background: \"rgba(0,0,0,.35)\" }}>\n          <div className=\"modal-dialog\" role=\"document\">\n            <div className=\"modal-content\">\n              <div className=\"modal-header\">\n                <h5 className=\"modal-title\">\n                  {mode === \"create\" ? \"Add Publisher Type\" : \"Edit Publisher Type\"}\n                </h5>\n                <button type=\"button\" className=\"btn-close\" onClick={closeModal} />\n              </div>\n\n              <div className=\"modal-body\">\n                <div className=\"mb-3\">\n                  <label className=\"form-label\">Type Name</label>\n                  <input className=\"form-control\" value={name} onChange={(e) => setName(e.target.value)} />\n                </div>\n\n                <div className=\"mb-0\">\n                  <label className=\"form-label\">Description (optional)</label>\n                  <textarea\n                    className=\"form-control\"\n                    rows=\"3\"\n                    value={description}\n                    onChange={(e) => setDescription(e.target.value)}\n                  />\n                </div>\n              </div>\n\n              <div className=\"modal-footer\">\n                <button className=\"btn btn-outline-secondary\" onClick={closeModal}>\n                  Cancel\n                </button>\n                <button className=\"btn btn-primary\" onClick={saveType} disabled={loading}>\n                  {loading ? \"Saving...\" : \"Save\"}\n                </button>\n              </div>\n            </div>\n          </div>\n        </div>\n      )}\n\n      <ToastContainer position=\"top-center\" />\n    </div>\n  );\n}\n"
        }
    ]
}