{
    "sourceFile": "src/pages/admin/PendingListings.jsx",
    "activeCommit": 0,
    "commits": [
        {
            "activePatchIndex": 2,
            "patches": [
                {
                    "date": 1766938964786,
                    "content": "Index: \n===================================================================\n--- \n+++ \n"
                },
                {
                    "date": 1766939224580,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -1,3 +1,170 @@\n-export default function PendingListings() {\n-  return <div className=\"fw-bold\">Pending Listings (Coming Next)</div>;\n-}\n\\ No newline at end of file\n+import { useEffect, useState } from \"react\";\n+\n+export default function ListingReviewModal({\n+  open,\n+  onClose,\n+  loading,\n+  listing,\n+  onApprove,\n+  onReject,\n+  actionLoading,\n+}) {\n+  const [reason, setReason] = useState(\"\");\n+\n+  useEffect(() => {\n+    if (open) setReason(\"\");\n+  }, [open]);\n+\n+  if (!open) return null;\n+\n+  return (\n+    <>\n+      <div className=\"modal fade show\" style={{ display: \"block\" }} tabIndex=\"-1\">\n+        <div className=\"modal-dialog modal-lg modal-dialog-scrollable\">\n+          <div className=\"modal-content rounded-4\">\n+            <div className=\"modal-header\">\n+              <h5 className=\"modal-title fw-bold\">\n+                Review Listing\n+              </h5>\n+              <button className=\"btn-close\" onClick={onClose} />\n+            </div>\n+\n+            <div className=\"modal-body\">\n+              {loading ? (\n+                <div className=\"text-muted\">Loading…</div>\n+              ) : !listing ? (\n+                <div className=\"alert alert-warning mb-0\">No listing found.</div>\n+              ) : (\n+                <div className=\"d-flex flex-column gap-3\">\n+                  <div>\n+                    <div className=\"text-muted small\">Title</div>\n+                    <div className=\"fw-bold fs-5\">{listing.title}</div>\n+                  </div>\n+\n+                  <div className=\"row g-3\">\n+                    <div className=\"col-md-4\">\n+                      <div className=\"text-muted small\">Type</div>\n+                      <div className=\"fw-semibold\">{listing?.type?.name || \"—\"}</div>\n+                    </div>\n+                    <div className=\"col-md-4\">\n+                      <div className=\"text-muted small\">Status</div>\n+                      <span className={`badge ${listing.status === \"pending\" ? \"bg-warning\" : listing.status === \"approved\" ? \"bg-success\" : \"bg-danger\"}`}>\n+                        {listing.status}\n+                      </span>\n+                    </div>\n+                    <div className=\"col-md-4\">\n+                      <div className=\"text-muted small\">Created</div>\n+                      <div className=\"fw-semibold\">\n+                        {listing.createdAt ? new Date(listing.createdAt).toLocaleString() : \"—\"}\n+                      </div>\n+                    </div>\n+                  </div>\n+\n+                  <div>\n+                    <div className=\"text-muted small\">Publisher</div>\n+                    <div className=\"fw-semibold\">\n+                      {listing?.publisherId?.companyName || \"—\"}{\" \"}\n+                      <span className=\"text-muted\">\n+                        ({listing?.publisherId?.userId?.email || \"—\"})\n+                      </span>\n+                    </div>\n+                  </div>\n+\n+                  <div>\n+                    <div className=\"text-muted small\">Description</div>\n+                    <div className=\"bg-light rounded-3 p-3\">\n+                      {listing.description}\n+                    </div>\n+                  </div>\n+\n+                  <div className=\"row g-3\">\n+                    <div className=\"col-md-6\">\n+                      <div className=\"text-muted small\">Location</div>\n+                      <div className=\"fw-semibold\">{listing.location || \"—\"}</div>\n+                    </div>\n+                    <div className=\"col-md-6\">\n+                      <div className=\"text-muted small\">Deadline</div>\n+                      <div className=\"fw-semibold\">\n+                        {listing.deadline ? new Date(listing.deadline).toLocaleDateString() : \"—\"}\n+                      </div>\n+                    </div>\n+                    <div className=\"col-md-6\">\n+                      <div className=\"text-muted small\">Start Date</div>\n+                      <div className=\"fw-semibold\">\n+                        {listing.startDate ? new Date(listing.startDate).toLocaleDateString() : \"—\"}\n+                      </div>\n+                    </div>\n+                    <div className=\"col-md-6\">\n+                      <div className=\"text-muted small\">End Date</div>\n+                      <div className=\"fw-semibold\">\n+                        {listing.endDate ? new Date(listing.endDate).toLocaleDateString() : \"—\"}\n+                      </div>\n+                    </div>\n+                  </div>\n+\n+                  <div>\n+                    <div className=\"text-muted small mb-1\">Attachments</div>\n+                    {!listing.attachments?.length ? (\n+                      <div className=\"text-muted\">No attachments</div>\n+                    ) : (\n+                      <div className=\"d-flex flex-wrap gap-2\">\n+                        {listing.attachments.map((a, idx) => (\n+                          <a\n+                            key={a.publicId || idx}\n+                            href={a.url}\n+                            target=\"_blank\"\n+                            rel=\"noreferrer\"\n+                            className=\"btn btn-outline-secondary btn-sm\"\n+                          >\n+                            <i className=\"bi bi-paperclip me-1\" />\n+                            Attachment {idx + 1}\n+                          </a>\n+                        ))}\n+                      </div>\n+                    )}\n+                  </div>\n+\n+                  <div>\n+                    <div className=\"text-muted small\">Rejection reason (if rejecting)</div>\n+                    <textarea\n+                      className=\"form-control\"\n+                      rows={3}\n+                      placeholder=\"Write reason for rejection…\"\n+                      value={reason}\n+                      onChange={(e) => setReason(e.target.value)}\n+                    />\n+                  </div>\n+                </div>\n+              )}\n+            </div>\n+\n+            <div className=\"modal-footer\">\n+              <button className=\"btn btn-light border\" onClick={onClose} disabled={actionLoading}>\n+                Close\n+              </button>\n+\n+              <button\n+                className=\"btn btn-danger\"\n+                disabled={actionLoading || loading || !listing}\n+                onClick={() => onReject(reason)}\n+              >\n+                {actionLoading ? \"Processing…\" : \"Reject\"}\n+              </button>\n+\n+              <button\n+                className=\"btn btn-success\"\n+                disabled={actionLoading || loading || !listing}\n+                onClick={onApprove}\n+              >\n+                {actionLoading ? \"Processing…\" : \"Approve\"}\n+              </button>\n+            </div>\n+          </div>\n+        </div>\n+      </div>\n+\n+      {/* Backdrop */}\n+      <div className=\"modal-backdrop fade show\" onClick={onClose} />\n+    </>\n+  );\n+}\n"
                },
                {
                    "date": 1766939246298,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -1,170 +1,283 @@\n import { useEffect, useState } from \"react\";\n+import { toast } from \"react-toastify\";\n \n-export default function ListingReviewModal({\n-  open,\n-  onClose,\n-  loading,\n-  listing,\n-  onApprove,\n-  onReject,\n-  actionLoading,\n-}) {\n-  const [reason, setReason] = useState(\"\");\n+import {\n+  getAdminListings,\n+  getAdminListingById,\n+  approveAdminListing,\n+  rejectAdminListing,\n+} from \"../../api/adminListings\";\n \n+import Pagination from \"../../components/Pagination\";\n+import ListingReviewModal from \"../../components/ListingReviewModal\";\n+\n+export default function PendingListings() {\n+  const [loading, setLoading] = useState(true);\n+  const [rows, setRows] = useState([]);\n+  const [meta, setMeta] = useState({ page: 1, totalPages: 1, limit: 20, total: 0 });\n+\n+  // Filters\n+  const [q, setQ] = useState(\"\");\n+  const [from, setFrom] = useState(\"\");\n+  const [to, setTo] = useState(\"\");\n+  const [sort, setSort] = useState(\"new\");\n+  const [limit, setLimit] = useState(20);\n+  const [page, setPage] = useState(1);\n+\n+  // Modal\n+  const [open, setOpen] = useState(false);\n+  const [selectedId, setSelectedId] = useState(null);\n+  const [detailLoading, setDetailLoading] = useState(false);\n+  const [detail, setDetail] = useState(null);\n+  const [actionLoading, setActionLoading] = useState(false);\n+\n+  const load = async () => {\n+    try {\n+      setLoading(true);\n+      const res = await getAdminListings({\n+        status: \"pending\",\n+        q: q || undefined,\n+        from: from || undefined,\n+        to: to || undefined,\n+        sort,\n+        page,\n+        limit,\n+      });\n+\n+      setRows(res.data?.listings || []);\n+      setMeta(res.data?.meta || { page: 1, totalPages: 1, limit, total: 0 });\n+    } catch (err) {\n+      toast.error(err?.response?.data?.message || \"Failed to load pending listings\");\n+    } finally {\n+      setLoading(false);\n+    }\n+  };\n+\n   useEffect(() => {\n-    if (open) setReason(\"\");\n-  }, [open]);\n+    load();\n+    // eslint-disable-next-line react-hooks/exhaustive-deps\n+  }, [page, limit, sort]);\n \n-  if (!open) return null;\n+  const applyFilters = () => {\n+    setPage(1);\n+    load();\n+  };\n \n+  const openReview = async (id) => {\n+    setSelectedId(id);\n+    setOpen(true);\n+    setDetail(null);\n+\n+    try {\n+      setDetailLoading(true);\n+      const res = await getAdminListingById(id);\n+      setDetail(res.data?.listing || null);\n+    } catch (err) {\n+      toast.error(err?.response?.data?.message || \"Failed to load listing detail\");\n+    } finally {\n+      setDetailLoading(false);\n+    }\n+  };\n+\n+  const approve = async () => {\n+    if (!selectedId) return;\n+\n+    try {\n+      setActionLoading(true);\n+      await approveAdminListing(selectedId);\n+      toast.success(\"Approved\");\n+      setOpen(false);\n+      await load();\n+    } catch (err) {\n+      toast.error(err?.response?.data?.message || \"Approve failed\");\n+    } finally {\n+      setActionLoading(false);\n+    }\n+  };\n+\n+  const reject = async (reason) => {\n+    if (!selectedId) return;\n+\n+    try {\n+      setActionLoading(true);\n+      await rejectAdminListing(selectedId, reason);\n+      toast.success(\"Rejected\");\n+      setOpen(false);\n+      await load();\n+    } catch (err) {\n+      toast.error(err?.response?.data?.message || \"Reject failed\");\n+    } finally {\n+      setActionLoading(false);\n+    }\n+  };\n+\n   return (\n-    <>\n-      <div className=\"modal fade show\" style={{ display: \"block\" }} tabIndex=\"-1\">\n-        <div className=\"modal-dialog modal-lg modal-dialog-scrollable\">\n-          <div className=\"modal-content rounded-4\">\n-            <div className=\"modal-header\">\n-              <h5 className=\"modal-title fw-bold\">\n-                Review Listing\n-              </h5>\n-              <button className=\"btn-close\" onClick={onClose} />\n-            </div>\n+    <div className=\"p-2 p-md-3\">\n+      <div className=\"d-flex align-items-center justify-content-between mb-3\">\n+        <div>\n+          <h3 className=\"fw-bold mb-1\">Pending Listings</h3>\n+          <div className=\"text-muted small\">Approve or reject publisher submissions</div>\n+        </div>\n+      </div>\n \n-            <div className=\"modal-body\">\n+      {/* Filters */}\n+      <div className=\"bg-white rounded-4 shadow-sm p-3 mb-3\">\n+        <div className=\"row g-2 align-items-end\">\n+          <div className=\"col-12 col-md-4\">\n+            <label className=\"form-label small text-muted\">Search</label>\n+            <input\n+              className=\"form-control\"\n+              placeholder=\"Search title/description…\"\n+              value={q}\n+              onChange={(e) => setQ(e.target.value)}\n+            />\n+          </div>\n+\n+          <div className=\"col-6 col-md-2\">\n+            <label className=\"form-label small text-muted\">From</label>\n+            <input className=\"form-control\" type=\"date\" value={from} onChange={(e) => setFrom(e.target.value)} />\n+          </div>\n+\n+          <div className=\"col-6 col-md-2\">\n+            <label className=\"form-label small text-muted\">To</label>\n+            <input className=\"form-control\" type=\"date\" value={to} onChange={(e) => setTo(e.target.value)} />\n+          </div>\n+\n+          <div className=\"col-6 col-md-2\">\n+            <label className=\"form-label small text-muted\">Sort</label>\n+            <select className=\"form-select\" value={sort} onChange={(e) => setSort(e.target.value)}>\n+              <option value=\"new\">Newest</option>\n+              <option value=\"old\">Oldest</option>\n+            </select>\n+          </div>\n+\n+          <div className=\"col-6 col-md-2\">\n+            <label className=\"form-label small text-muted\">Per page</label>\n+            <select className=\"form-select\" value={limit} onChange={(e) => setLimit(Number(e.target.value))}>\n+              <option value={10}>10</option>\n+              <option value={20}>20</option>\n+              <option value={50}>50</option>\n+            </select>\n+          </div>\n+\n+          <div className=\"col-12 d-flex gap-2 justify-content-end\">\n+            <button className=\"btn btn-light border\" onClick={() => { setQ(\"\"); setFrom(\"\"); setTo(\"\"); setSort(\"new\"); setLimit(20); setPage(1); setTimeout(load, 0); }}>\n+              Reset\n+            </button>\n+            <button className=\"btn btn-success\" onClick={applyFilters}>\n+              <i className=\"bi bi-search me-1\" />\n+              Apply\n+            </button>\n+          </div>\n+        </div>\n+      </div>\n+\n+      {/* Table */}\n+      <div className=\"bg-white rounded-4 shadow-sm p-0 overflow-hidden\">\n+        <div className=\"d-flex justify-content-between align-items-center p-3 border-bottom\">\n+          <div className=\"fw-bold\">Results</div>\n+          <div className=\"text-muted small\">\n+            Total: <span className=\"fw-semibold\">{meta.total || 0}</span>\n+          </div>\n+        </div>\n+\n+        <div className=\"table-responsive\">\n+          <table className=\"table align-middle mb-0\">\n+            <thead className=\"table-light\">\n+              <tr>\n+                <th style={{ minWidth: 260 }}>Title</th>\n+                <th style={{ minWidth: 140 }}>Type</th>\n+                <th style={{ minWidth: 200 }}>Publisher</th>\n+                <th style={{ minWidth: 120 }}>Created</th>\n+                <th className=\"text-end\" style={{ minWidth: 220 }}>Actions</th>\n+              </tr>\n+            </thead>\n+\n+            <tbody>\n               {loading ? (\n-                <div className=\"text-muted\">Loading…</div>\n-              ) : !listing ? (\n-                <div className=\"alert alert-warning mb-0\">No listing found.</div>\n+                <tr>\n+                  <td colSpan={5} className=\"p-4 text-muted\">Loading…</td>\n+                </tr>\n+              ) : rows.length === 0 ? (\n+                <tr>\n+                  <td colSpan={5} className=\"p-4 text-muted\">No pending listings found.</td>\n+                </tr>\n               ) : (\n-                <div className=\"d-flex flex-column gap-3\">\n-                  <div>\n-                    <div className=\"text-muted small\">Title</div>\n-                    <div className=\"fw-bold fs-5\">{listing.title}</div>\n-                  </div>\n-\n-                  <div className=\"row g-3\">\n-                    <div className=\"col-md-4\">\n-                      <div className=\"text-muted small\">Type</div>\n-                      <div className=\"fw-semibold\">{listing?.type?.name || \"—\"}</div>\n-                    </div>\n-                    <div className=\"col-md-4\">\n-                      <div className=\"text-muted small\">Status</div>\n-                      <span className={`badge ${listing.status === \"pending\" ? \"bg-warning\" : listing.status === \"approved\" ? \"bg-success\" : \"bg-danger\"}`}>\n-                        {listing.status}\n-                      </span>\n-                    </div>\n-                    <div className=\"col-md-4\">\n-                      <div className=\"text-muted small\">Created</div>\n-                      <div className=\"fw-semibold\">\n-                        {listing.createdAt ? new Date(listing.createdAt).toLocaleString() : \"—\"}\n+                rows.map((r) => (\n+                  <tr key={r._id}>\n+                    <td>\n+                      <div className=\"fw-semibold\">{r.title}</div>\n+                      <div className=\"text-muted small text-truncate\" style={{ maxWidth: 360 }}>\n+                        {r.description}\n                       </div>\n-                    </div>\n-                  </div>\n+                    </td>\n \n-                  <div>\n-                    <div className=\"text-muted small\">Publisher</div>\n-                    <div className=\"fw-semibold\">\n-                      {listing?.publisherId?.companyName || \"—\"}{\" \"}\n-                      <span className=\"text-muted\">\n-                        ({listing?.publisherId?.userId?.email || \"—\"})\n+                    <td>\n+                      <span className=\"badge bg-secondary\">\n+                        {r?.type?.name || \"—\"}\n                       </span>\n-                    </div>\n-                  </div>\n+                    </td>\n \n-                  <div>\n-                    <div className=\"text-muted small\">Description</div>\n-                    <div className=\"bg-light rounded-3 p-3\">\n-                      {listing.description}\n-                    </div>\n-                  </div>\n+                    <td>\n+                      <div className=\"fw-semibold\">{r?.publisherId?.companyName || \"—\"}</div>\n+                      <div className=\"text-muted small\">{r?.publisherId?.userId?.email || \"\"}</div>\n+                    </td>\n \n-                  <div className=\"row g-3\">\n-                    <div className=\"col-md-6\">\n-                      <div className=\"text-muted small\">Location</div>\n-                      <div className=\"fw-semibold\">{listing.location || \"—\"}</div>\n-                    </div>\n-                    <div className=\"col-md-6\">\n-                      <div className=\"text-muted small\">Deadline</div>\n-                      <div className=\"fw-semibold\">\n-                        {listing.deadline ? new Date(listing.deadline).toLocaleDateString() : \"—\"}\n-                      </div>\n-                    </div>\n-                    <div className=\"col-md-6\">\n-                      <div className=\"text-muted small\">Start Date</div>\n-                      <div className=\"fw-semibold\">\n-                        {listing.startDate ? new Date(listing.startDate).toLocaleDateString() : \"—\"}\n-                      </div>\n-                    </div>\n-                    <div className=\"col-md-6\">\n-                      <div className=\"text-muted small\">End Date</div>\n-                      <div className=\"fw-semibold\">\n-                        {listing.endDate ? new Date(listing.endDate).toLocaleDateString() : \"—\"}\n-                      </div>\n-                    </div>\n-                  </div>\n+                    <td className=\"text-muted small\">\n+                      {r.createdAt ? new Date(r.createdAt).toLocaleDateString() : \"—\"}\n+                    </td>\n \n-                  <div>\n-                    <div className=\"text-muted small mb-1\">Attachments</div>\n-                    {!listing.attachments?.length ? (\n-                      <div className=\"text-muted\">No attachments</div>\n-                    ) : (\n-                      <div className=\"d-flex flex-wrap gap-2\">\n-                        {listing.attachments.map((a, idx) => (\n-                          <a\n-                            key={a.publicId || idx}\n-                            href={a.url}\n-                            target=\"_blank\"\n-                            rel=\"noreferrer\"\n-                            className=\"btn btn-outline-secondary btn-sm\"\n-                          >\n-                            <i className=\"bi bi-paperclip me-1\" />\n-                            Attachment {idx + 1}\n-                          </a>\n-                        ))}\n+                    <td className=\"text-end\">\n+                      <div className=\"d-flex gap-2 justify-content-end\">\n+                        <button className=\"btn btn-outline-secondary btn-sm\" onClick={() => openReview(r._id)}>\n+                          View\n+                        </button>\n+\n+                        <button\n+                          className=\"btn btn-success btn-sm\"\n+                          onClick={async () => {\n+                            if (!window.confirm(\"Approve this listing?\")) return;\n+                            try {\n+                              await approveAdminListing(r._id);\n+                              toast.success(\"Approved\");\n+                              load();\n+                            } catch (err) {\n+                              toast.error(err?.response?.data?.message || \"Approve failed\");\n+                            }\n+                          }}\n+                        >\n+                          Approve\n+                        </button>\n+\n+                        <button\n+                          className=\"btn btn-danger btn-sm\"\n+                          onClick={() => openReview(r._id)} // reject with reason from modal\n+                        >\n+                          Reject\n+                        </button>\n                       </div>\n-                    )}\n-                  </div>\n-\n-                  <div>\n-                    <div className=\"text-muted small\">Rejection reason (if rejecting)</div>\n-                    <textarea\n-                      className=\"form-control\"\n-                      rows={3}\n-                      placeholder=\"Write reason for rejection…\"\n-                      value={reason}\n-                      onChange={(e) => setReason(e.target.value)}\n-                    />\n-                  </div>\n-                </div>\n+                    </td>\n+                  </tr>\n+                ))\n               )}\n-            </div>\n+            </tbody>\n+          </table>\n+        </div>\n \n-            <div className=\"modal-footer\">\n-              <button className=\"btn btn-light border\" onClick={onClose} disabled={actionLoading}>\n-                Close\n-              </button>\n-\n-              <button\n-                className=\"btn btn-danger\"\n-                disabled={actionLoading || loading || !listing}\n-                onClick={() => onReject(reason)}\n-              >\n-                {actionLoading ? \"Processing…\" : \"Reject\"}\n-              </button>\n-\n-              <button\n-                className=\"btn btn-success\"\n-                disabled={actionLoading || loading || !listing}\n-                onClick={onApprove}\n-              >\n-                {actionLoading ? \"Processing…\" : \"Approve\"}\n-              </button>\n-            </div>\n-          </div>\n+        <div className=\"p-3 border-top\">\n+          <Pagination page={meta.page || page} totalPages={meta.totalPages || 1} onPage={(p) => setPage(p)} />\n         </div>\n       </div>\n \n-      {/* Backdrop */}\n-      <div className=\"modal-backdrop fade show\" onClick={onClose} />\n-    </>\n+      <ListingReviewModal\n+        open={open}\n+        onClose={() => setOpen(false)}\n+        loading={detailLoading}\n+        listing={detail}\n+        onApprove={approve}\n+        onReject={reject}\n+        actionLoading={actionLoading}\n+      />\n+    </div>\n   );\n }\n"
                }
            ],
            "date": 1766938964786,
            "name": "Commit-0",
            "content": "export default function PendingListings() {\n  return <div className=\"fw-bold\">Pending Listings (Coming Next)</div>;\n}"
        }
    ]
}