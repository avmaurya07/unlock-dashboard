{
    "sourceFile": "src/pages/admin/Users.jsx",
    "activeCommit": 0,
    "commits": [
        {
            "activePatchIndex": 0,
            "patches": [
                {
                    "date": 1766941107006,
                    "content": "Index: \n===================================================================\n--- \n+++ \n"
                }
            ],
            "date": 1766941107006,
            "name": "Commit-0",
            "content": "import { useEffect, useState } from \"react\";\nimport { toast } from \"react-toastify\";\n\nimport Pagination from \"../../components/Pagination\";\nimport { getAdminUsers, setUserBlocked } from \"../../api/adminUsers\";\n\nexport default function Users() {\n  const [loading, setLoading] = useState(true);\n  const [rows, setRows] = useState([]);\n  const [meta, setMeta] = useState({ page: 1, totalPages: 1, total: 0, limit: 20 });\n\n  // Filters\n  const [q, setQ] = useState(\"\");\n  const [role, setRole] = useState(\"all\"); // all | user | publisher | admin\n  const [status, setStatus] = useState(\"all\"); // all | active | blocked\n  const [page, setPage] = useState(1);\n  const [limit, setLimit] = useState(20);\n\n  const [actionLoading, setActionLoading] = useState(false);\n\n  const load = async () => {\n    try {\n      setLoading(true);\n\n      const res = await getAdminUsers({\n        q: q || undefined,\n        role: role === \"all\" ? undefined : role,\n        status: status === \"all\" ? undefined : status, // backend should map active/blocked\n        page,\n        limit,\n      });\n\n      setRows(res.data?.users || []);\n      setMeta(res.data?.meta || { page, totalPages: 1, total: 0, limit });\n    } catch (err) {\n      toast.error(err?.response?.data?.message || \"Failed to load users\");\n    } finally {\n      setLoading(false);\n    }\n  };\n\n  useEffect(() => {\n    load();\n    // eslint-disable-next-line react-hooks/exhaustive-deps\n  }, [page, limit, role, status]);\n\n  const applyFilters = () => {\n    setPage(1);\n    load();\n  };\n\n  const resetFilters = () => {\n    setQ(\"\");\n    setRole(\"all\");\n    setStatus(\"all\");\n    setLimit(20);\n    setPage(1);\n    setTimeout(load, 0);\n  };\n\n  const toggleBlock = async (u) => {\n    try {\n      setActionLoading(true);\n      const next = !u.blocked;\n\n      const confirmText = next ? \"Block this user?\" : \"Unblock this user?\";\n      if (!window.confirm(confirmText)) return;\n\n      await setUserBlocked(u._id, next);\n      toast.success(next ? \"User blocked\" : \"User unblocked\");\n      await load();\n    } catch (err) {\n      toast.error(err?.response?.data?.message || \"Failed to update user\");\n    } finally {\n      setActionLoading(false);\n    }\n  };\n\n  const roleBadge = (r) => {\n    if (r === \"admin\") return \"bg-dark\";\n    if (r === \"publisher\") return \"bg-primary\";\n    return \"bg-secondary\";\n  };\n\n  return (\n    <div className=\"p-2 p-md-3\">\n      <div className=\"d-flex align-items-center justify-content-between mb-3\">\n        <div>\n          <h3 className=\"fw-bold mb-1\">Users</h3>\n          <div className=\"text-muted small\">Manage platform users (block/unblock)</div>\n        </div>\n      </div>\n\n      {/* Filters */}\n      <div className=\"bg-white rounded-4 shadow-sm p-3 mb-3\">\n        <div className=\"row g-2 align-items-end\">\n          <div className=\"col-12 col-md-6\">\n            <label className=\"form-label small text-muted\">Search</label>\n            <input\n              className=\"form-control\"\n              placeholder=\"Search name / email / phone…\"\n              value={q}\n              onChange={(e) => setQ(e.target.value)}\n            />\n          </div>\n\n          <div className=\"col-6 col-md-2\">\n            <label className=\"form-label small text-muted\">Role</label>\n            <select className=\"form-select\" value={role} onChange={(e) => setRole(e.target.value)}>\n              <option value=\"all\">All</option>\n              <option value=\"user\">User</option>\n              <option value=\"publisher\">Publisher</option>\n              <option value=\"admin\">Admin</option>\n            </select>\n          </div>\n\n          <div className=\"col-6 col-md-2\">\n            <label className=\"form-label small text-muted\">Status</label>\n            <select className=\"form-select\" value={status} onChange={(e) => setStatus(e.target.value)}>\n              <option value=\"all\">All</option>\n              <option value=\"active\">Active</option>\n              <option value=\"blocked\">Blocked</option>\n            </select>\n          </div>\n\n          <div className=\"col-6 col-md-2\">\n            <label className=\"form-label small text-muted\">Per page</label>\n            <select className=\"form-select\" value={limit} onChange={(e) => setLimit(Number(e.target.value))}>\n              <option value={10}>10</option>\n              <option value={20}>20</option>\n              <option value={50}>50</option>\n            </select>\n          </div>\n\n          <div className=\"col-12 d-flex gap-2 justify-content-end\">\n            <button className=\"btn btn-light border\" onClick={resetFilters}>\n              Reset\n            </button>\n            <button className=\"btn btn-success\" onClick={applyFilters}>\n              <i className=\"bi bi-search me-1\" />\n              Apply\n            </button>\n          </div>\n        </div>\n      </div>\n\n      {/* Table */}\n      <div className=\"bg-white rounded-4 shadow-sm p-0 overflow-hidden\">\n        <div className=\"d-flex justify-content-between align-items-center p-3 border-bottom\">\n          <div className=\"fw-bold\">Results</div>\n          <div className=\"text-muted small\">\n            Total: <span className=\"fw-semibold\">{meta.total || 0}</span>\n          </div>\n        </div>\n\n        <div className=\"table-responsive\">\n          <table className=\"table align-middle mb-0\">\n            <thead className=\"table-light\">\n              <tr>\n                <th style={{ minWidth: 220 }}>User</th>\n                <th style={{ minWidth: 160 }}>Contact</th>\n                <th style={{ minWidth: 120 }}>Role</th>\n                <th style={{ minWidth: 120 }}>Verified</th>\n                <th style={{ minWidth: 120 }}>Status</th>\n                <th className=\"text-end\" style={{ minWidth: 200 }}>Actions</th>\n              </tr>\n            </thead>\n\n            <tbody>\n              {loading ? (\n                <tr><td colSpan={6} className=\"p-4 text-muted\">Loading…</td></tr>\n              ) : rows.length === 0 ? (\n                <tr><td colSpan={6} className=\"p-4 text-muted\">No users found.</td></tr>\n              ) : (\n                rows.map((u) => (\n                  <tr key={u._id}>\n                    <td>\n                      <div className=\"fw-semibold\">{u.name || \"—\"}</div>\n                      <div className=\"text-muted small\">{u.email || \"—\"}</div>\n                    </td>\n\n                    <td className=\"text-muted small\">\n                      <div>{u.phone || \"—\"}</div>\n                      <div>{u.country || \"\"}</div>\n                    </td>\n\n                    <td>\n                      <span className={`badge ${roleBadge(u.role || \"user\")}`}>\n                        {u.role || \"user\"}\n                      </span>\n                    </td>\n\n                    <td>\n                      <span className={`badge ${u.isEmailVerified ? \"bg-success\" : \"bg-light text-dark border\"}`}>\n                        {u.isEmailVerified ? \"Yes\" : \"No\"}\n                      </span>\n                    </td>\n\n                    <td>\n                      <span className={`badge ${u.blocked ? \"bg-danger\" : \"bg-success\"}`}>\n                        {u.blocked ? \"Blocked\" : \"Active\"}\n                      </span>\n                    </td>\n\n                    <td className=\"text-end\">\n                      <button\n                        className={`btn btn-sm ${u.blocked ? \"btn-outline-success\" : \"btn-danger\"}`}\n                        disabled={actionLoading}\n                        onClick={() => toggleBlock(u)}\n                      >\n                        {u.blocked ? \"Unblock\" : \"Block\"}\n                      </button>\n                    </td>\n                  </tr>\n                ))\n              )}\n            </tbody>\n          </table>\n        </div>\n\n        <div className=\"p-3 border-top\">\n          <Pagination\n            page={meta.page || page}\n            totalPages={meta.totalPages || 1}\n            onPage={(p) => setPage(p)}\n          />\n        </div>\n      </div>\n    </div>\n  );\n}\n"
        }
    ]
}