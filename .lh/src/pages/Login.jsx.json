{
    "sourceFile": "src/pages/Login.jsx",
    "activeCommit": 0,
    "commits": [
        {
            "activePatchIndex": 6,
            "patches": [
                {
                    "date": 1766174960737,
                    "content": "Index: \n===================================================================\n--- \n+++ \n"
                },
                {
                    "date": 1766175053240,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -44,9 +44,9 @@\n       ) : (\n         <>\n           <h2>Enter OTP</h2>\n           <input\n-            type=\"text\"\n+            type=\"text\"₹\n             placeholder=\"OTP\"\n             value={otp}\n             onChange={(e) => setOtp(e.target.value)}\n           />\n"
                },
                {
                    "date": 1766175059024,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -1,58 +0,0 @@\n-import { useState } from \"react\";\n-import axios from \"axios\";\n-import { saveToken } from \"../utils/auth\";\n-\n-export default function Login() {\n-  const [email, setEmail] = useState(\"\");\n-  const [otpSent, setOtpSent] = useState(false);\n-  const [otp, setOtp] = useState(\"\");\n-\n-  const sendOtp = async () => {\n-    await axios.post(\"http://localhost:5000/api/auth/send-otp\", { email });\n-    setOtpSent(true);\n-  };\n-\n-  const verifyOtp = async () => {\n-    const res = await axios.post(\"http://localhost:5000/api/auth/verify-otp\", {\n-      email,\n-      otp,\n-    });\n-\n-    if (res.data.success) {\n-      saveToken(res.data.token);\n-      const role = res.data.user.role;\n-\n-      if (role === \"admin\") window.location.href = \"/dashboard/admin\";\n-      else if (role === \"publisher\") window.location.href = \"/dashboard/publisher\";\n-      else window.location.href = \"/dashboard/user\";\n-    }\n-  };\n-\n-  return (\n-    <div style={{ maxWidth: 350, margin: \"100px auto\" }}>\n-      {!otpSent ? (\n-        <>\n-          <h2>Login</h2>\n-          <input\n-            type=\"email\"\n-            placeholder=\"Enter email\"\n-            value={email}\n-            onChange={(e) => setEmail(e.target.value)}\n-          />\n-          <button onClick={sendOtp}>Send OTP</button>\n-        </>\n-      ) : (\n-        <>\n-          <h2>Enter OTP</h2>\n-          <input\n-            type=\"text\"₹\n-            placeholder=\"OTP\"\n-            value={otp}\n-            onChange={(e) => setOtp(e.target.value)}\n-          />\n-          <button onClick={verifyOtp}>Verify & Login</button>\n-        </>\n-      )}\n-    </div>\n-  );\n-}\n\\ No newline at end of file\n"
                },
                {
                    "date": 1766429194038,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -1,1 +1,120 @@\n+import { useState, useRef } from \"react\";\n+import axios from \"axios\";\n+import { ToastContainer, toast } from \"react-toastify\";\n \n+export default function Login() {\n+  const [email, setEmail] = useState(\"\");\n+  const [otpSent, setOtpSent] = useState(false);\n+  const [otp, setOtp] = useState([\"\", \"\", \"\", \"\", \"\", \"\"]);\n+  const inputRefs = useRef([]);\n+\n+  const handleEmailSubmit = async () => {\n+    if (!email) {\n+      toast.error(\"Please enter your email\");\n+      return;\n+    }\n+\n+    try {\n+      const res = await axios.post(\"http://localhost:5000/api/auth/send-otp\", { email });\n+\n+      if (res.data.success) {\n+        toast.success(\"OTP sent to your email!\");\n+        setOtpSent(true);\n+      }\n+    } catch (err) {\n+      toast.error(\"Failed to send OTP\");\n+    }\n+  };\n+\n+  const handleOtpChange = (value, index) => {\n+    if (!/^[0-9]?$/.test(value)) return;\n+\n+    const updatedOtp = [...otp];\n+    updatedOtp[index] = value;\n+    setOtp(updatedOtp);\n+\n+    if (value && index < 5) {\n+      inputRefs.current[index + 1].focus();\n+    }\n+  };\n+\n+  const verifyOtp = async () => {\n+    const otpValue = otp.join(\"\");\n+\n+    if (otpValue.length !== 6) {\n+      toast.error(\"Please enter all 6 digits\");\n+      return;\n+    }\n+\n+    try {\n+      const res = await axios.post(\"http://localhost:5000/api/auth/verify-otp\", {\n+        email,\n+        otp: otpValue,\n+        role: \"user\"  // or publisher if coming from vendor login\n+      });\n+\n+      if (res.data.success) {\n+        toast.success(\"Login successful!\");\n+\n+        localStorage.setItem(\"token\", res.data.token);\n+\n+        const role = res.data.user.role;\n+\n+        if (role === \"admin\") window.location.href = \"/dashboard/admin\";\n+        else if (role === \"publisher\") window.location.href = \"/dashboard/publisher\";\n+        else window.location.href = \"/dashboard/user\";\n+      }\n+    } catch (err) {\n+      toast.error(\"Invalid or expired OTP\");\n+    }\n+  };\n+\n+  return (\n+    <div className=\"container d-flex justify-content-center align-items-center\" style={{ minHeight: \"100vh\" }}>\n+      <div className=\"card shadow p-4\" style={{ width: \"380px\" }}>\n+        <h4 className=\"text-center mb-4\">Login</h4>\n+\n+        {!otpSent ? (\n+          <>\n+            <label className=\"form-label\">Email Address</label>\n+            <input\n+              type=\"email\"\n+              className=\"form-control mb-3\"\n+              placeholder=\"Enter your email\"\n+              value={email}\n+              onChange={(e) => setEmail(e.target.value)}\n+            />\n+\n+            <button className=\"btn btn-primary w-100\" onClick={handleEmailSubmit}>\n+              Send OTP\n+            </button>\n+          </>\n+        ) : (\n+          <>\n+            <label className=\"form-label\">Enter OTP</label>\n+            <div className=\"d-flex justify-content-between\">\n+              {[0, 1, 2, 3, 4, 5].map((i) => (\n+                <input\n+                  key={i}\n+                  type=\"text\"\n+                  maxLength=\"1\"\n+                  className=\"form-control text-center mx-1\"\n+                  style={{ width: \"45px\", fontSize: \"22px\" }}\n+                  value={otp[i]}\n+                  onChange={(e) => handleOtpChange(e.target.value, i)}\n+                  ref={(el) => (inputRefs.current[i] = el)}\n+                />\n+              ))}\n+            </div>\n+\n+            <button className=\"btn btn-success w-100 mt-3\" onClick={verifyOtp}>\n+              Verify OTP\n+            </button>\n+          </>\n+        )}\n+      </div>\n+\n+      <ToastContainer position=\"top-center\" />\n+    </div>\n+  );\n+}\n"
                },
                {
                    "date": 1766942437781,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -1,7 +1,8 @@\n import { useState, useRef } from \"react\";\n import axios from \"axios\";\n import { ToastContainer, toast } from \"react-toastify\";\n+import { Link } from \"react-router-dom\";\n \n export default function Login() {\n   const [email, setEmail] = useState(\"\");\n   const [otpSent, setOtpSent] = useState(false);\n"
                },
                {
                    "date": 1766942458455,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -88,8 +88,15 @@\n \n             <button className=\"btn btn-primary w-100\" onClick={handleEmailSubmit}>\n               Send OTP\n             </button>\n+\n+            <div className=\"text-center mt-3\">\n+  <span className=\"text-muted\">Don’t have an account?</span>{\" \"}\n+  <Link to=\"/register-publisher\" className=\"fw-semibold text-decoration-none\">\n+    Register now\n+  </Link>\n+</div>\n           </>\n         ) : (\n           <>\n             <label className=\"form-label\">Enter OTP</label>\n"
                },
                {
                    "date": 1766942878503,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -69,60 +69,6 @@\n       toast.error(\"Invalid or expired OTP\");\n     }\n   };\n \n-  return (\n-    <div className=\"container d-flex justify-content-center align-items-center\" style={{ minHeight: \"100vh\" }}>\n-      <div className=\"card shadow p-4\" style={{ width: \"380px\" }}>\n-        <h4 className=\"text-center mb-4\">Login</h4>\n \n-        {!otpSent ? (\n-          <>\n-            <label className=\"form-label\">Email Address</label>\n-            <input\n-              type=\"email\"\n-              className=\"form-control mb-3\"\n-              placeholder=\"Enter your email\"\n-              value={email}\n-              onChange={(e) => setEmail(e.target.value)}\n-            />\n-\n-            <button className=\"btn btn-primary w-100\" onClick={handleEmailSubmit}>\n-              Send OTP\n-            </button>\n-\n-            <div className=\"text-center mt-3\">\n-  <span className=\"text-muted\">Don’t have an account?</span>{\" \"}\n-  <Link to=\"/register-publisher\" className=\"fw-semibold text-decoration-none\">\n-    Register now\n-  </Link>\n-</div>\n-          </>\n-        ) : (\n-          <>\n-            <label className=\"form-label\">Enter OTP</label>\n-            <div className=\"d-flex justify-content-between\">\n-              {[0, 1, 2, 3, 4, 5].map((i) => (\n-                <input\n-                  key={i}\n-                  type=\"text\"\n-                  maxLength=\"1\"\n-                  className=\"form-control text-center mx-1\"\n-                  style={{ width: \"45px\", fontSize: \"22px\" }}\n-                  value={otp[i]}\n-                  onChange={(e) => handleOtpChange(e.target.value, i)}\n-                  ref={(el) => (inputRefs.current[i] = el)}\n-                />\n-              ))}\n-            </div>\n-\n-            <button className=\"btn btn-success w-100 mt-3\" onClick={verifyOtp}>\n-              Verify OTP\n-            </button>\n-          </>\n-        )}\n-      </div>\n-\n-      <ToastContainer position=\"top-center\" />\n-    </div>\n-  );\n }\n"
                }
            ],
            "date": 1766174960737,
            "name": "Commit-0",
            "content": "import { useState } from \"react\";\nimport axios from \"axios\";\nimport { saveToken } from \"../utils/auth\";\n\nexport default function Login() {\n  const [email, setEmail] = useState(\"\");\n  const [otpSent, setOtpSent] = useState(false);\n  const [otp, setOtp] = useState(\"\");\n\n  const sendOtp = async () => {\n    await axios.post(\"http://localhost:5000/api/auth/send-otp\", { email });\n    setOtpSent(true);\n  };\n\n  const verifyOtp = async () => {\n    const res = await axios.post(\"http://localhost:5000/api/auth/verify-otp\", {\n      email,\n      otp,\n    });\n\n    if (res.data.success) {\n      saveToken(res.data.token);\n      const role = res.data.user.role;\n\n      if (role === \"admin\") window.location.href = \"/dashboard/admin\";\n      else if (role === \"publisher\") window.location.href = \"/dashboard/publisher\";\n      else window.location.href = \"/dashboard/user\";\n    }\n  };\n\n  return (\n    <div style={{ maxWidth: 350, margin: \"100px auto\" }}>\n      {!otpSent ? (\n        <>\n          <h2>Login</h2>\n          <input\n            type=\"email\"\n            placeholder=\"Enter email\"\n            value={email}\n            onChange={(e) => setEmail(e.target.value)}\n          />\n          <button onClick={sendOtp}>Send OTP</button>\n        </>\n      ) : (\n        <>\n          <h2>Enter OTP</h2>\n          <input\n            type=\"text\"\n            placeholder=\"OTP\"\n            value={otp}\n            onChange={(e) => setOtp(e.target.value)}\n          />\n          <button onClick={verifyOtp}>Verify & Login</button>\n        </>\n      )}\n    </div>\n  );\n}\n"
        }
    ]
}