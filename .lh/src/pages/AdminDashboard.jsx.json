{
    "sourceFile": "src/pages/AdminDashboard.jsx",
    "activeCommit": 0,
    "commits": [
        {
            "activePatchIndex": 1,
            "patches": [
                {
                    "date": 1766175011752,
                    "content": "Index: \n===================================================================\n--- \n+++ \n"
                },
                {
                    "date": 1766938548448,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -1,9 +1,141 @@\n-import ProtectedRoute from \"../components/ProtectedRoute\";\n+import { useEffect, useMemo, useState } from \"react\";\n+import { toast } from \"react-toastify\";\n \n+import {\n+  getAdminSummary,\n+  getListingsByType,\n+  getListingsTrends,\n+} from \"../api/adminDashboard\";\n+\n+import {\n+  Chart as ChartJS,\n+  CategoryScale,\n+  LinearScale,\n+  PointElement,\n+  LineElement,\n+  Tooltip,\n+  Legend,\n+} from \"chart.js\";\n+import { Line } from \"react-chartjs-2\";\n+\n+ChartJS.register(CategoryScale, LinearScale, PointElement, LineElement, Tooltip, Legend);\n+\n+function monthLabel(year, month) {\n+  const d = new Date(year, month - 1, 1);\n+  return d.toLocaleString(\"en-US\", { month: \"short\" }) + \" \" + year;\n+}\n+\n export default function AdminDashboard() {\n+  const [loading, setLoading] = useState(true);\n+  const [summary, setSummary] = useState(null);\n+  const [byType, setByType] = useState([]);\n+  const [trends, setTrends] = useState([]);\n+  const months = 12;\n+\n+  useEffect(() => {\n+    (async () => {\n+      try {\n+        setLoading(true);\n+        const [s, t, tr] = await Promise.all([\n+          getAdminSummary(),\n+          getListingsByType(),\n+          getListingsTrends({ months }),\n+        ]);\n+        setSummary(s.data?.summary || null);\n+        setByType(t.data?.data || []);\n+        setTrends(tr.data?.data || []);\n+      } catch (err) {\n+        toast.error(err?.response?.data?.message || \"Failed to load admin dashboard\");\n+      } finally {\n+        setLoading(false);\n+      }\n+    })();\n+  }, []);\n+\n+  const cards = useMemo(() => {\n+    if (!summary) return [];\n+    const subs = summary.publishers.subscriptionHealth || {};\n+    const listingStatus = summary.listings.statusCounts || {};\n+\n+    return [\n+      { title: \"Total Users\", value: summary.users.totalUsers, icon: \"bi-people\" },\n+      { title: \"Total Publishers\", value: summary.publishers.totalPublishers, icon: \"bi-buildings\" },\n+      { title: \"Pending Approvals\", value: summary.listings.pendingApprovals, icon: \"bi-hourglass-split\" },\n+      { title: \"Active Subs\", value: subs.active || 0, icon: \"bi-check-circle\" },\n+      { title: \"Expired Subs\", value: subs.expired || 0, icon: \"bi-x-circle\" },\n+      { title: \"Suspended Subs\", value: subs.suspended || 0, icon: \"bi-slash-circle\" },\n+      { title: \"Approved Listings\", value: listingStatus.approved || 0, icon: \"bi-patch-check\" },\n+      { title: \"Rejected Listings\", value: listingStatus.rejected || 0, icon: \"bi-shield-x\" },\n+    ];\n+  }, [summary]);\n+\n+  const trendChartData = useMemo(() => {\n+    return {\n+      labels: trends.map((r) => monthLabel(r.year, r.month)),\n+      datasets: [{ label: \"Listings Created\", data: trends.map((r) => r.count), tension: 0.35 }],\n+    };\n+  }, [trends]);\n+\n+  if (loading) return <div className=\"p-4\">Loadingâ€¦</div>;\n+  if (!summary) return <div className=\"p-4 alert alert-warning\">No data.</div>;\n+\n   return (\n-    <ProtectedRoute>\n-      <h1>Admin Panel</h1>\n-    </ProtectedRoute>\n+    <div className=\"p-4\" style={{ width: \"100%\" }}>\n+      <h2 className=\"fw-bold mb-3\">Admin Dashboard</h2>\n+\n+      <div className=\"row g-3 mb-4\">\n+        {cards.map((c) => (\n+          <div className=\"col-12 col-md-6 col-lg-3\" key={c.title}>\n+            <div className=\"p-3 bg-white rounded-4 shadow-sm d-flex justify-content-between align-items-center\">\n+              <div>\n+                <div className=\"text-muted small\">{c.title}</div>\n+                <div className=\"fs-3 fw-bold\">{c.value}</div>\n+              </div>\n+              <i className={`bi ${c.icon} fs-2 text-primary`} />\n+            </div>\n+          </div>\n+        ))}\n+      </div>\n+\n+      <div className=\"row g-3\">\n+        <div className=\"col-12 col-lg-7\">\n+          <div className=\"p-3 bg-white rounded-4 shadow-sm\">\n+            <div className=\"d-flex justify-content-between mb-2\">\n+              <div className=\"fw-bold\">Listings Trend</div>\n+              <div className=\"text-muted small\">Last {months} months</div>\n+            </div>\n+            <Line data={trendChartData} options={{ responsive: true }} />\n+          </div>\n+        </div>\n+\n+        <div className=\"col-12 col-lg-5\">\n+          <div className=\"p-3 bg-white rounded-4 shadow-sm\">\n+            <div className=\"fw-bold mb-2\">Listings by Type</div>\n+            <div className=\"table-responsive\">\n+              <table className=\"table table-sm align-middle mb-0\">\n+                <thead>\n+                  <tr className=\"text-muted\">\n+                    <th>Type</th>\n+                    <th className=\"text-end\">Count</th>\n+                  </tr>\n+                </thead>\n+                <tbody>\n+                  {byType.map((r) => (\n+                    <tr key={r.typeId}>\n+                      <td className=\"fw-semibold\">{r.typeName}</td>\n+                      <td className=\"text-end fw-bold\">{r.count}</td>\n+                    </tr>\n+                  ))}\n+                  {byType.length === 0 && (\n+                    <tr><td colSpan={2} className=\"text-muted\">No data</td></tr>\n+                  )}\n+                </tbody>\n+              </table>\n+            </div>\n+          </div>\n+        </div>\n+      </div>\n+\n+    </div>\n   );\n }\n"
                }
            ],
            "date": 1766175011752,
            "name": "Commit-0",
            "content": "import ProtectedRoute from \"../components/ProtectedRoute\";\n\nexport default function AdminDashboard() {\n  return (\n    <ProtectedRoute>\n      <h1>Admin Panel</h1>\n    </ProtectedRoute>\n  );\n}\n"
        }
    ]
}